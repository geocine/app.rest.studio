<div class="toolbar font-small flex-center">
    <div class="flex-100">
        <a *ngFor="let field of ['query', 'header', 'path', 'body', 'description']"
           class="option"
           [ngClass]="{on: !off[field]}"
           (click)="toggleField(field)">{{field | rsTitleCase}}</a>
    </div>
    <div class="flex-1">
        <div class="btn-group">
            <button class="btn btn-sm btn-success ion-play link" (click)="run()"> Run</button>
            <button type="button" class="btn btn-sm btn-success link dropdown-toggle dropdown-toggle-split"
                    data-toggle="dropdown">
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="link dropdown-item ion-android-share"> Share</a>
            </div>
        </div>
    </div>
</div>
<div class="content" *ngIf="iRequest">
    <div class="section">
        <div class="b" style="padding: .7em 0;">
            <input class="form-control b" placeholder="request title" [(ngModel)]="iRequest.title"
                   (change)="emitChanges()"/>
        </div>
        <div style="display: flex; align-items: center;">
            <div class="btn-group">
                <a class="link dropdown-toggle" data-toggle="dropdown">
                    {{iRequest.method}}
                </a>
                <div class="dropdown-menu">
                    <a *ngFor="let method of methods"
                       class="link dropdown-item"
                       (click)="setMethod(method)">{{method}}</a>
                </div>
            </div>
            <div style="flex-grow: 100; margin-left: .5em;">
                <input #urlInput type="text" class="form-control" [(ngModel)]="iRequest.url"
                       (change)="emitChanges()"/>
            </div>
        </div>
    </div>
    <div class="section" *ngIf="!off.query">
        <div class="header d-flex justify-content-end">
            <div class="mr-auto"><b>Query</b></div>
            <a class="link" (click)="extractQuery()">Extract From URL</a>
        </div>
        <request-param-group [paramGroup]="iRequest.queryParams"
                             (paramsUpdated)="emitChanges()">
        </request-param-group>
    </div>
    <div class="section" *ngIf="!off.header">
        <div class="header d-flex justify-content-end">
            <div class="mr-auto"><b>Header</b></div>
            <a class="ion-plus link" (click)="pickHeaders()"> Insert</a>
        </div>
        <request-param-group [paramGroup]="iRequest.headerParams"
                             (paramsUpdated)="emitChanges()">
        </request-param-group>
    </div>
    <div class="section" *ngIf="!off.body">
        <div class="header d-flex justify-content-end">
            <div class="mr-auto"><b>Body</b></div>
            <a class="dropdown">
                <a class="dropdown-toggle link" data-toggle="dropdown">
                    {{iRequest?.mode || 'none'}}
                </a>
                <div class="dropdown-menu dropdown-menu-right font-small b">
                    <a class="dropdown-item" *ngFor="let mode of modes"
                       (click)="setBodyMode(mode)">{{mode}}</a>
                </div>
            </a>
        </div>
        <request-param-group [paramGroup]="iRequest.formParams"
                             (paramsUpdated)="emitChanges()"
                             *ngIf="bodyEditor === $BodyEditor.FORM">
        </request-param-group>
        <text-editor [text]="iRequest?.body" [minLines]="5" [maxLines]="30" [mode]="editorMode"
                     [lineNumbers]="true" [wrap]="true" [observeText]="true"
                     (onTextChanged)="updateBody($event.text)"
                     [hidden]="bodyEditor !== $BodyEditor.EDITOR"></text-editor>
        <div *ngIf="bodyEditor === $BodyEditor.BIN">
            <h3>Coming soon</h3>
        </div>
        <div *ngIf="!bodyEditor">
            No body
        </div>
    </div>
    <div class="section" *ngIf="!off.description">
        <div class="header d-flex justify-content-end">
            <div class="mr-auto"><b>Description</b></div>
        </div>
        <textarea class="form-control" rows="5"
                  (change)="updateDescription($event.target.value)">{{iRequest?.description}}</textarea>
    </div>
</div>
<header-picker #headerPicker (onHeadersPicker)="addHeaders($event)"></header-picker>
